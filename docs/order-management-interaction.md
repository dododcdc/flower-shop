# 订单管理界面 - 交互设计文档

## 一、页面布局

```
┌─────────────────────────────────────────────────────────────┐
│ 📊 订单管理                              [新增订单](不需要)   │
├─────────────────────────────────────────────────────────────┤
│ 🔍 搜索订单号/客户姓名/手机号                                 │
├─────────────────────────────────────────────────────────────┤
│ 状态: [全部][待确认][准备中][配送中][已完成][已取消]        │
│ 日期: [今天][本周][本月][自定义日期范围]                     │
│ 排序: [最新][金额↓][金额↑]                      [重置筛选]  │
├─────────────────────────────────────────────────────────────┤
│ ┌───────────────────────────────────────────────────────┐   │
│ │ 🛒 订单号: FH20250102001       [待确认]               │   │
│ │ 👤 张三  138****1234              💰 ¥328.00          │   │
│ │ 📍 上海市浦东新区...                                 │   │
│ │ 📦 3件商品     ⏰ 期望配送: 今天 16:00-18:00           │   │
│ │ 📝 备注：请在贺卡上写"生日快乐"                         │   │
│ │                                                       │   │
│ │ [查看详情] [确认订单] [取消订单]                        │   │
│ └───────────────────────────────────────────────────────┘   │
│ ┌───────────────────────────────────────────────────────┐   │
│ │ 🛒 订单号: FH20250102002       [准备中]               │   │
│ │ ...                                                   │   │
│ └───────────────────────────────────────────────────────┘   │
│ ...                                                    ...   │
├─────────────────────────────────────────────────────────────┤
│              分页: < 1 2 3 ... 10 >                        │
└─────────────────────────────────────────────────────────────┘
```

---

## 二、筛选和排序区域

### 2.1 搜索框
- **位置**：第一行独占
- **宽度**：400px
- **占位符**："搜索订单号/客户姓名/手机号"
- **功能**：
  - 支持订单号搜索（精确匹配）
  - 支持客户姓名搜索（模糊匹配）
  - 支持手机号搜索（精确匹配）
  - 实时搜索（防抖500ms）
  - 有清除按钮

### 2.2 订单状态筛选
- **形式**：横向chips
- **选项**：
  - 全部（默认）
  - 待确认（橙色）
  - 准备中（蓝色）
  - 配送中（浅蓝）
  - 已完成（紫色）
  - 已取消（灰色）
- **交互**：点击立即筛选，自动触发后端API

### 2.3 时间范围筛选
- **形式**：横向chips
- **选项**：
  - 全部（默认）
  - 今天
  - 本周
  - 本月
  - 自定义（日期选择器）
- **交互**：点击立即筛选

### 2.4 排序方式
- **形式**：横向chips
- **选项**：
  - 最新（默认）
  - 金额高→低
  - 金额低→高
- **交互**：点击立即排序

### 2.5 重置按钮
- **位置**：第三行右侧
- **功能**：重置所有筛选条件到初始状态

---

## 三、订单卡片展示

### 3.1 卡片布局

```
┌────────────────────────────────────────────────────┐
│ 🛒 订单号: FH20250102001        [状态标签]        │
│ 👤 客户: 张三  138****1234      💰 ¥328.00        │
│ 📍 配送地址...                                    │
│ 📦 3件商品  🚚 玫瑰花束×1, 百合花束×2              │
│ ⏰ 期望配送: 今天 16:00-18:00                       │
│ 💬 备注: 请在贺卡上写"生日快乐"                       │
│                                                      │
│ [查看详情] [状态操作按钮]                            │
└────────────────────────────────────────────────────┘
```

### 3.2 字段说明

| 字段 | 说明 | 格式 |
|------|------|------|
| 订单号 | 点击可复制 | FH20250102001 |
| 状态标签 | 颜色区分 | 待确认/准备中/配送中/已完成/已取消 |
| 客户信息 | 姓名和脱敏手机号 | 张三 138****1234 |
| 配送地址 | 显示前20个字符+... | 上海市浦东新区... |
| 金额 | 突出显示 | ¥328.00 |
| 商品信息 | 商品数量和名称摘要 | 3件商品 |
| 商品详情 | 鼠标悬浮显示全部 | 玫瑰花束×1, 百合花束×2 |
| 期望配送时间 | 时间段 | 今天 16:00-18:00 |
| 备注 | 用户填写的备注 | 如有贺卡内容也显示 |

### 3.3 卡片状态颜色

| 订单状态 | 标签背景色 | 文字颜色 |
|---------|-----------|---------|
| 待确认 | 橙色 | 白色 |
| 准备中 | 蓝色 | 白色 |
| 配送中 | 浅蓝 | 白色 |
| 已完成 | 紫色 | 白色 |
| 已取消 | 灰色 | 白色 |

---

## 四、订单操作按钮

### 4.1 根据订单状态显示不同按钮

| 订单状态 | 操作按钮 | 说明 |
|---------|---------|------|
| 待确认 | [确认订单] [取消订单] | 确认后进入准备中 |
| 准备中 | [开始配送] [取消订单] | 开始配送后进入配送中 |
| 配送中 | [完成配送并收款] [联系客户] | 完成后订单完成，支付状态变为已支付 |
| 已完成 | [查看详情] [再次购买] | 仅查看，不可操作 |
| 已取消 | [查看详情] [恢复订单] | 可恢复（如误取消） |

### 4.2 按钮样式

- **主操作**：实心按钮（确认、开始配送、完成配送）
- **次要操作**：描边按钮（查看详情、联系客户）
- **危险操作**：红色按钮（取消订单）

---

## 五、订单详情弹窗

### 5.1 触发方式
- 点击订单卡片中的"查看详情"按钮
- 点击订单号（快捷方式）

### 5.2 弹窗布局

```
┌────────────────────────────────────────────┐
│ 订单详情                      [✕ 关闭]   │
├────────────────────────────────────────────┤
│ 基本信息                                     │
│ ├─ 订单号: FH20250102001                   │
│ ├─ 订单状态: 准备中                         │
│ ├─ 下单时间: 2025-01-02 14:30              │
│ ├─ 支付方式: 到付                          │
│ └─ 支付状态: 待支付                         │
│                                              │
│ 客户信息                                     │
│ ├─ 姓名: 张三                               │
│ ├─ 手机: 13812341234                        │
│ └─ 地址: 上海市浦东新区...                  │
│                                              │
│ 商品信息                                     │
│ ├─ 玫瑰花束 ×1         ¥199.00              │
│ ├─ 百合花束 ×2         ¥258.00              │
│ └─ 商品总价:           ¥457.00              │
│                                              │
│ 费用明细                                     │
│ ├─ 商品总价: ¥457.00                       │
│ ├─ 配送费:   ¥10.00                         │
│ └─ 最终金额: ¥467.00                        │
│                                              │
│ 配送信息                                     │
│ ├─ 期望配送时间: 今天 16:00-18:00            │
│ ├─ 贺卡内容: 生日快乐                        │
│ ├─ 贺卡署名: 小明                            │
│ └─ 订单备注: 请准时配送                      │
│                                              │
│ 操作按钮                                     │
│     [联系客户] [打印订单] [确认订单]         │
└────────────────────────────────────────────┘
```

### 5.3 字段说明

**基本信息区域**
- 订单号：可复制
- 订单状态：带颜色标签
- 下单时间：完整时间戳
- 支付方式：到付
- 支付状态：待支付/已支付

**客户信息区域**
- 姓名、手机号（完整）
- 完整配送地址

**商品信息区域**
- 商品名称、数量、单价
- 商品总价小计
- 点击商品名称跳转到商品详情

**费用明细区域**
- 商品总价
- 配送费
- 最终金额（加粗突出）

**配送信息区域**
- 期望配送时间段
- 贺卡内容（如有）
- 贺卡署名（如有）
- 订单备注（如有）

**操作按钮区域**
- 根据订单状态显示对应按钮
- 联系客户（复制手机号并拨打）
- 打印订单（生成打印页面）

---

## 六、状态流转交互

### 6.1 确认订单流程

```
用户点击"确认订单"
  ↓
弹出确认对话框
  "确认订单号为 FH20250102001 的订单吗？"
  [取消] [确认]
  ↓
点击"确认"
  ↓
调用后端API: PUT /api/orders/{id}/confirm
  ↓
成功提示: "订单已确认，开始准备商品"
  ↓
订单状态: 准备中
```

### 6.2 开始配送流程

```
用户点击"开始配送"
  ↓
弹出确认对话框
  "订单 FH20250102001 准备完成，开始配送？"
  [取消] [确认]
  ↓
点击"确认"
  ↓
调用后端API: PUT /api/orders/{id}/deliver
  ↓
成功提示: "订单已进入配送状态"
  ↓
订单状态: 配送中
```

### 6.3 完成配送并收款流程

```
用户点击"完成配送并收款"
  ↓
弹出确认对话框
  "订单 FH20250102001 已完成配送并收到款项？"
  "收到金额: ¥467.00"
  [取消] [确认收款]
  ↓
点击"确认收款"
  ↓
调用后端API: PUT /api/orders/{id}/complete
  ↓
后端处理:
  - 订单状态 → 已完成
  - 支付状态 → 已支付
  - 记录完成时间
  ↓
成功提示: "订单已完成，收款 ¥467.00"
  ↓
订单状态: 已完成
支付状态: 已支付
```

### 6.4 取消订单流程

```
用户点击"取消订单"
  ↓
弹窗: 输入取消原因
  "请选择取消原因："
  ○ 客户要求取消
  ○ 商品缺货
  ○ 配送范围外
  ○ 其他原因
  [取消] [确认取消]
  ↓
调用后端API: PUT /api/orders/{id}/cancel
  ↓
成功提示: "订单已取消"
  ↓
订单状态: 已取消
```

---

## 七、交互细节

### 7.1 新订单提醒
- 当有新订单时，页面顶部显示提示横幅
- 提示内容："🔔 您有 1 个新订单（FH20250102001）"
- 点击横幅跳转到该订单详情
- 提示横幅可手动关闭

### 7.2 空状态
- 无订单时显示友好提示
```
┌─────────────────────────┐
│                         │
│    📦                  │
│   暂无订单              │
│                         │
│ 等待客户下单中...       │
│                         │
└─────────────────────────┘
```

### 7.3 加载状态
- 列表加载时显示骨架屏
- 操作按钮点击后显示loading状态
- 操作完成后显示成功/失败提示

### 7.4 错误处理
- 网络错误提示："网络错误，请稍后重试"
- 权限错误提示："无权操作"
- 业务错误提示：显示后端返回的错误信息

### 7.5 快捷操作
- **复制订单号**：点击订单号自动复制到剪贴板，提示"已复制"
- **拨打电话**：点击手机号自动调起拨号界面
- **查看地址**：点击地址显示完整地址，可复制
- **悬浮显示商品**：鼠标悬浮在"3件商品"上，显示完整商品列表

---

## 八、响应式设计

### 8.1 桌面端（>960px）
- 订单卡片：一行3-4个
- 搜索框：400px宽
- 筛选chips：横向排列

### 8.2 平板端（768px-960px）
- 订单卡片：一行2个
- 搜索框：100%宽
- 筛选chips：自动换行

### 8.3 移动端（<768px）
- 订单卡片：一行1个
- 搜索框：100%宽
- 筛选chips：横向滚动

---

## 九、性能优化

### 9.1 数据加载
- 首次加载：每页10条
- 分页加载：支持点击分页
- 滚动加载（可选）：滚动到底部自动加载下一页

### 9.2 实时更新
- 新订单轮询（可选）：每30秒轮询一次新订单
- WebSocket推送（高级）：实时接收新订单通知

### 9.3 缓存策略
- 订单列表不缓存（保证数据实时）
- 订单详情缓存5分钟（减少重复查询）

---

## 十、实现步骤建议

### Phase 1: 基础列表
1. 订单列表页面布局
2. 筛选和排序chips
3. 搜索框
4. 订单卡片展示
5. 分页功能

### Phase 2: 订单操作
6. 订单详情弹窗
7. 确认订单功能
8. 取消订单功能
9. 状态流转提示

### Phase 3: 高级功能
10. 开始配送功能
11. 完成配送并收款功能
12. 新订单提醒
13. 打印订单功能
14. 导出订单Excel

---

## 十一、后端API需求

### 11.1 查询接口
```
GET /api/orders/search?page=1&size=10&status=PENDING&startDate=&endDate=&keyword=
```

### 11.2 详情接口
```
GET /api/orders/{id}
```

### 11.3 操作接口
```
PUT /api/orders/{id}/confirm    # 确认订单
PUT /api/orders/{id}/deliver    # 开始配送
PUT /api/orders/{id}/complete   # 完成配送并收款
PUT /api/orders/{id}/cancel     # 取消订单
```

### 11.4 统计接口
```
GET /api/orders/stats?period=today
返回: { total: 10, pending: 2, preparing: 3, delivering: 3, completed: 2 }
```

---

## 十二、字段对应表

| 前端显示 | 后端字段 | 数据库字段 | 说明 |
|---------|---------|-----------|------|
| 订单号 | orderNo | order_no | 唯一标识 |
| 订单状态 | status | status | PENDING/PREPARING/DELIVERING/COMPLETED/CANCELLED |
| 客户姓名 | customerName | customer_name | |
| 客户手机 | customerPhone | customer_phone | |
| 配送地址 | - | - | 从delivery_addresses表获取 |
| 期望配送时间 | deliveryTime | delivery_time | |
| 商品总价 | totalAmount | total_amount | |
| 配送费 | deliveryFee | delivery_fee | |
| 最终金额 | finalAmount | final_amount | |
| 支付方式 | paymentMethod | payment_method | ON_DELIVERY |
| 支付状态 | paymentStatus | payment_status | PENDING/PAID/REFUNDED |
| 下单时间 | createdAt | created_at | |
| 备注 | notes | notes | |
| 贺卡内容 | cardContent | card_content | |
| 贺卡署名 | cardSender | card_sender | |

---

## 十三、开发检查清单

### 数据准备
- [ ] 确认订单表结构正确
- [ ] 确认订单项表结构正确
- [ ] 确认配送地址表结构正确

### 后端开发
- [ ] 实现订单查询接口（支持分页、筛选）
- [ ] 实现订单详情接口
- [ ] 实现订单状态流转接口
- [ ] 实现订单统计接口
- [ ] 添加接口权限控制

### 前端开发
- [ ] 实现订单列表页面布局
- [ ] 实现筛选和排序chips
- [ ] 实现搜索框（防抖）
- [ ] 实现订单卡片组件
- [ ] 实现订单详情弹窗
- [ ] 实现订单操作按钮
- [ ] 实现状态流转交互
- [ ] 实现分页组件
- [ ] 实现新订单提醒

### 测试
- [ ] 测试订单列表展示
- [ ] 测试筛选和排序功能
- [ ] 测试搜索功能
- [ ] 测试订单详情查看
- [ ] 测试订单状态流转
- [ ] 测试取消订单流程
- [ ] 测试边界情况处理

---

## 十四、UI设计规范

### 14.1 颜色定义
```css
--primary-color: #1B3A2B;     /* 主色调：深绿 */
--accent-color: #D4AF37;      /* 强调色：金色 */
--status-pending: #FF9800;    /* 待确认：橙色 */
--status-preparing: #2196F3;  /* 准备中：蓝色 */
--status-delivering: #03A9F4; /* 配送中：浅蓝 */
--status-completed: #9C27B0;  /* 已完成：紫色 */
--status-cancelled: #F44336;  /* 已取消：红色 */
```

### 14.2 间距定义
```css
--spacing-xs: 4px;
--spacing-sm: 8px;
--spacing-md: 16px;
--spacing-lg: 24px;
--spacing-xl: 32px;
```

### 14.3 字体大小
```css
--font-size-sm: 13px;
--font-size-md: 14px;
--font-size-lg: 16px;
--font-size-xl: 18px;
--font-size-2xl: 24px;
```

---

## 十五、备注

### 15.1 设计原则
- **简洁高效**：减少操作步骤，提升管理效率
- **状态清晰**：用颜色和标签明确区分订单状态
- **操作便捷**：常用操作一键完成，减少二次确认
- **信息完整**：卡片展示关键信息，详情页展示全部信息

### 15.2 扩展性考虑
- 预留批量操作入口（未来可添加批量确认、批量取消）
- 预留订单筛选扩展（未来可添加更多筛选条件）
- 预留数据统计入口（未来可添加销售统计图表）
- 预留导出功能（未来可添加Excel导出）

### 15.3 可访问性
- 支持键盘Tab导航
- 按钮有清晰的hover和focus状态
- 重要操作有二次确认
- 错误提示清晰明确
