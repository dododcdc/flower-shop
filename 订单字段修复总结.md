# 订单数据库字段修复总结

## 数据库表结构（实际）

根据 `DESC orders` 的结果，orders 表的关键字段类型如下：

```sql
status         ENUM('PENDING','PAID','PREPARING','DELIVERING','COMPLETED','CANCELLED')
payment_method ENUM('ALIPAY','WECHAT','CASH','MOCK')
payment_status ENUM('PENDING','PAID','REFUNDED')
```

## 修改内容

### 1. Order.java 实体类

**字段类型**：
- `status`: `String` (存储 ENUM 值)
- `paymentMethod`: `String` (存储 ENUM 值)
- `paymentStatus`: `String` (存储 ENUM 值)

**ENUM 值映射**：

#### status 字段
- `PENDING` - 待支付
- `PAID` - 已支付（待确认）
- `PREPARING` - 准备中
- `DELIVERING` - 配送中
- `COMPLETED` - 已完成
- `CANCELLED` - 已取消

#### payment_method 字段
- `ALIPAY` - 支付宝
- `WECHAT` - 微信支付
- `CASH` - 现金
- `MOCK` - 模拟支付

#### payment_status 字段
- `PENDING` - 待支付
- `PAID` - 已支付
- `REFUNDED` - 已退款

### 2. OrderServiceImpl.java

创建订单时设置的值：
```java
order.setStatus("PENDING");         // 待支付状态
order.setPaymentStatus("PENDING");  // 待支付
```

### 3. 辅助方法更新

- `getStatusText()`: 将 ENUM 值转换为中文显示
- `getPaymentMethodText()`: 将支付方式转换为中文
- `getPaymentStatusText()`: 将支付状态转换为中文
- `isPaid()`: 检查 `"PAID"`
- `isCompleted()`: 检查 `"COMPLETED"`
- `isCancelled()`: 检查 `"CANCELLED"`
- `canCancel()`: 允许 PENDING, PAID, PREPARING 状态取消
- `canConfirm()`: PAID 状态可确认
- `canShip()`: PREPARING 状态可发货
- `canComplete()`: DELIVERING 状态可完成

## 测试建议

1. 创建订单，检查 status 和 payment_status 是否正确保存为 `PENDING`
2. 验证订单状态文本显示是否正确
3. 测试订单状态流转：PENDING → PAID → PREPARING → DELIVERING → COMPLETED

## 注意事项

- 所有 ENUM 字段必须使用**大写**的 ENUM 值
- 数据库会自动验证 ENUM 值的有效性
- 如果插入无效的 ENUM 值，数据库会报错
